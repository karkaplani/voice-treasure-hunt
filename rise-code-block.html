<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <audio id="bgMusic" src="https://clever-gecko-e407f1.netlify.app/background_music.mp3" loop></audio>

  <div id="gameContainer">
    <h3 id="title">ðŸ’° Treasure Hunt! ðŸ§­</h3>
    <button id="startBtn" class="btn btn-start">Play</button>

    <canvas id="maze" width="300" height="300"></canvas>

    <!-- Direction buttons -->
    <div id="controls">
      <button onclick="movePlayer('north')" class="btn btn-control">North</button>
      <button onclick="movePlayer('south')" class="btn btn-control">South</button>
      <button onclick="movePlayer('west')" class="btn btn-control">West</button>
      <button onclick="movePlayer('east')" class="btn btn-control">East</button>
    </div>

    <p id="status">Click a button to move!</p>

    <button id="restartBtn" class="btn btn-restart">Restart</button>

  </div>

  <!-- Win Modal -->
  <div id="winModal">
    <div class="modalContent">
      <h2>Well done! ðŸŽ‰</h2>
      <button id="retryBtn" class="btn btn-start">Play Again</button>
      <p class="note">
        <a href="https://clever-gecko-e407f1.netlify.app/" target="_blank">
          Try voice-controlled version!
        </a>
      </p>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>


<style>
  body {
  background-color: #e0f7fa;
  margin: 0;
  padding: 0;
  font-family: sans-serif;
  text-align: center;
}

#title {
  font-family: 'Fredoka One', sans-serif;
  font-size: 36px;
  margin-bottom: 16px;
  color: #333;
}


#gameContainer {
  max-width: 600px;
  margin: auto;
  padding: 16px;
  min-height: 450px; /* keep the full game space reserved */
  box-sizing: border-box;

  display: flex;
  flex-direction: column;
  justify-content: center; 
  align-items: center;    
  text-align: center;
}



#maze {
  display: none;
  margin-top: 12px;
  border: none;
}

#controls {
  margin-top: 12px;
  display: none;
  gap: 8px;
  justify-content: center;
}

#status {
  font-weight: bold;
  margin-top: 12px;
  display: none;
}

.note {
  margin-top: 16px;
  font-size: 14px;
  color: #555;
}

.btn, 
.modalContent a {
  display: inline-block;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  color: white;
  cursor: pointer;
  font-size: 16px;
  text-decoration: none; 
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: all 0.2s ease-in-out;
}

.btn-start, 
.btn-control {
  background: #4caf50;
}

.btn-control {
  padding: 10px;
}

.btn-restart {
  margin-top: 12px;
  background: #f44336;
  padding: 8px 16px;
}

.btn:hover, 
.modalContent a:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
  filter: brightness(1.1);
}

#winModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  max-width: 250px;
}

.modalContent a {
  background: #4caf50; 
  color: white;        
  padding: 10px 16px;
  border-radius: 6px;
  display: inline-block;
  text-decoration: none;
  font-weight: bold;
  font-size: 14px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: all 0.2s ease-in-out;
}

.modalContent a:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
  filter: brightness(1.1);
}


</style>

<script>

const canvas = document.getElementById("maze");
const ctx = canvas.getContext("2d");
const statusEl = document.getElementById("status");
const bgMusic = document.getElementById("bgMusic");
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const title = document.getElementById("title");
const controls = document.getElementById("controls");

bgMusic.volume = 0.1;

const gridSize = 5;
const cellSize = canvas.width / gridSize;
let player = { x: 0, y: 0 };
const goal = { x: 4, y: 3 };

let animating = false;
let animX = player.x * cellSize;
let animY = player.y * cellSize;

const pirateImg = new Image();
pirateImg.src = "https://raw.githubusercontent.com/karkaplani/voice-treasure-hunt/refs/heads/main/pirate.png";
const treasureImg = new Image();
treasureImg.src = "https://raw.githubusercontent.com/karkaplani/voice-treasure-hunt/refs/heads/main/treasure.png";
const rockImg = new Image();
rockImg.src = "https://raw.githubusercontent.com/karkaplani/voice-treasure-hunt/refs/heads/main/rock.png";
const mapImg = new Image();
mapImg.src = "https://raw.githubusercontent.com/karkaplani/voice-treasure-hunt/refs/heads/main/treasure_map.png";

const obstacles = [
  {x:3, y:0}, {x:3, y:1}, {x:1, y:1}, {x:0, y:3},
  {x:0, y:1}, {x:3, y:2}, {x:4, y:2}, {x:0, y:2},
  {x:2, y:3}, {x:4, y:4}, {x:0, y:4}
];

const winModal = document.getElementById("winModal");
const retryBtn = document.getElementById("retryBtn");

// Reset to initial state when the replay button is clicked
function resetGame() {
  title.style.display = "block";
  startBtn.style.display = "inline-block";
  canvas.style.display = "none";
  controls.style.display = "none";
  statusEl.style.display = "none";
  restartBtn.style.display = "none";
  winModal.style.display = "none";
  bgMusic.pause();
  bgMusic.currentTime = 0;
  player = { x: 0, y: 0 };
  animX = player.x * cellSize;
  animY = player.y * cellSize;
}

// Start game when the play button is clicked
startBtn.addEventListener("click", () => {
  title.style.display = "none";
  startBtn.style.display = "none";
  canvas.style.display = "block";
  controls.style.display = "flex";
  statusEl.style.display = "block";
  restartBtn.style.display = "inline-block";
  drawMaze();
  bgMusic.play().catch(err => console.log("Audio play prevented:", err));
});

// Restart button
restartBtn.addEventListener("click", resetGame);

// Retry (after winning)
retryBtn.addEventListener("click", () => {
  winModal.style.display = "none";
  player = { x: 0, y: 0 };
  animX = player.x * cellSize;
  animY = player.y * cellSize;
  drawMaze();
  statusEl.innerText = "Game restarted! Click a button to move!";
});

// Ensure all images are loaded
let imagesLoaded = 0;
const totalImages = 4;
function checkAllLoaded() {
  imagesLoaded++;
  if(imagesLoaded === totalImages) {
    resetGame();
  }
}
pirateImg.onload = checkAllLoaded;
treasureImg.onload = checkAllLoaded;
rockImg.onload = checkAllLoaded;
mapImg.onload = checkAllLoaded;

// Draw maze
function drawMaze() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(mapImg, 0, 0, canvas.width, canvas.height);
  obstacles.forEach(cell => {
    ctx.drawImage(rockImg, cell.x * cellSize, cell.y * cellSize, cellSize, cellSize);
  });
  ctx.drawImage(treasureImg, goal.x * cellSize, goal.y * cellSize, cellSize, cellSize);
  ctx.drawImage(pirateImg, animX, animY, cellSize, cellSize);
}

// Animate pirate movement
function animateMove(targetX, targetY, callback) {
  animating = true;
  const startX = animX;
  const startY = animY;
  const endX = targetX * cellSize;
  const endY = targetY * cellSize;
  const duration = 200;
  const startTime = performance.now();

  function step(time) {
    const t = Math.min((time - startTime) / duration, 1);
    animX = startX + (endX - startX) * t;
    animY = startY + (endY - startY) * t;
    drawMaze();
    if(t < 1) requestAnimationFrame(step);
    else {
      animating = false;
      if(callback) callback();
    }
  }
  requestAnimationFrame(step);
}

// Move player
function movePlayer(direction) {
  if(animating) return;
  let targetX = player.x;
  let targetY = player.y;

  switch(direction) {
    case "north": targetY--; break;
    case "south": targetY++; break;
    case "west":  targetX--; break;
    case "east":  targetX++; break;
  }

  if(targetX < 0 || targetX >= gridSize || targetY < 0 || targetY >= gridSize) return;
  if(obstacles.some(o => o.x === targetX && o.y === targetY)) {
    statusEl.innerText = `â›” Obstacle in ${direction}!`;
    return;
  }

  player.x = targetX;
  player.y = targetY;
  animateMove(targetX, targetY, () => {
    if(player.x === goal.x && player.y === goal.y) {
      winModal.style.display = "flex";
    } else {
      statusEl.innerText = `Moved ${direction}`;
    }
  });
}
</script>
